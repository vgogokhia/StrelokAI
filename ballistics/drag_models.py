"""
Standard drag models for ballistic calculations
G1 and G7 drag coefficient tables

G1: Flat-base, blunt-nose projectiles (older standard)
G7: Long, boat-tail, spitzer bullets (modern standard for rifle bullets)

Data source: Ballistic coefficient tables from industry standards
"""

# G1 Drag Model (Ingalls Tables)
# Format: (Mach number, Cd coefficient)
G1_DRAG = [
    (0.00, 0.2629),
    (0.05, 0.2558),
    (0.10, 0.2487),
    (0.15, 0.2413),
    (0.20, 0.2344),
    (0.25, 0.2278),
    (0.30, 0.2214),
    (0.35, 0.2155),
    (0.40, 0.2104),
    (0.45, 0.2061),
    (0.50, 0.2032),
    (0.55, 0.2020),
    (0.60, 0.2034),
    (0.65, 0.2165),
    (0.70, 0.2230),
    (0.75, 0.2313),
    (0.80, 0.2417),
    (0.85, 0.2546),
    (0.90, 0.2706),
    (0.92, 0.2774),
    (0.94, 0.2842),
    (0.96, 0.2920),
    (0.98, 0.3010),
    (1.00, 0.3110),
    (1.02, 0.3220),
    (1.04, 0.3340),
    (1.06, 0.3470),
    (1.08, 0.3600),
    (1.10, 0.3720),
    (1.12, 0.3830),
    (1.14, 0.3940),
    (1.16, 0.4040),
    (1.18, 0.4130),
    (1.20, 0.4210),
    (1.25, 0.4370),
    (1.30, 0.4480),
    (1.35, 0.4550),
    (1.40, 0.4590),
    (1.45, 0.4590),
    (1.50, 0.4570),
    (1.55, 0.4530),
    (1.60, 0.4470),
    (1.65, 0.4410),
    (1.70, 0.4340),
    (1.75, 0.4270),
    (1.80, 0.4200),
    (1.85, 0.4130),
    (1.90, 0.4060),
    (1.95, 0.4000),
    (2.00, 0.3940),
    (2.05, 0.3880),
    (2.10, 0.3830),
    (2.15, 0.3780),
    (2.20, 0.3730),
    (2.25, 0.3690),
    (2.30, 0.3650),
    (2.35, 0.3610),
    (2.40, 0.3580),
    (2.45, 0.3550),
    (2.50, 0.3520),
    (2.60, 0.3470),
    (2.70, 0.3420),
    (2.80, 0.3370),
    (2.90, 0.3330),
    (3.00, 0.3290),
    (3.10, 0.3250),
    (3.20, 0.3210),
    (3.30, 0.3180),
    (3.40, 0.3150),
    (3.50, 0.3120),
    (3.60, 0.3100),
    (3.70, 0.3080),
    (3.80, 0.3060),
    (3.90, 0.3040),
    (4.00, 0.3020),
    (4.20, 0.2990),
    (4.40, 0.2960),
    (4.60, 0.2930),
    (4.80, 0.2910),
    (5.00, 0.2890),
]

# G7 Drag Model (Modern boat-tail bullets)
# Format: (Mach number, Cd coefficient)
G7_DRAG = [
    (0.00, 0.1198),
    (0.05, 0.1197),
    (0.10, 0.1196),
    (0.15, 0.1194),
    (0.20, 0.1193),
    (0.25, 0.1194),
    (0.30, 0.1194),
    (0.35, 0.1194),
    (0.40, 0.1193),
    (0.45, 0.1193),
    (0.50, 0.1194),
    (0.55, 0.1193),
    (0.60, 0.1194),
    (0.65, 0.1197),
    (0.70, 0.1202),
    (0.75, 0.1207),
    (0.80, 0.1215),
    (0.85, 0.1226),
    (0.875, 0.1242),
    (0.90, 0.1266),
    (0.925, 0.1306),
    (0.95, 0.1368),
    (0.975, 0.1464),
    (1.00, 0.1660),
    (1.025, 0.2054),
    (1.05, 0.2440),
    (1.075, 0.2735),
    (1.10, 0.2922),
    (1.125, 0.3022),
    (1.15, 0.3066),
    (1.175, 0.3076),
    (1.20, 0.3066),
    (1.25, 0.3017),
    (1.30, 0.2944),
    (1.35, 0.2864),
    (1.40, 0.2783),
    (1.45, 0.2704),
    (1.50, 0.2628),
    (1.55, 0.2558),
    (1.60, 0.2493),
    (1.65, 0.2432),
    (1.70, 0.2376),
    (1.75, 0.2324),
    (1.80, 0.2276),
    (1.85, 0.2230),
    (1.90, 0.2188),
    (1.95, 0.2149),
    (2.00, 0.2112),
    (2.05, 0.2077),
    (2.10, 0.2045),
    (2.15, 0.2014),
    (2.20, 0.1986),
    (2.25, 0.1958),
    (2.30, 0.1932),
    (2.35, 0.1907),
    (2.40, 0.1883),
    (2.45, 0.1860),
    (2.50, 0.1838),
    (2.55, 0.1816),
    (2.60, 0.1796),
    (2.65, 0.1776),
    (2.70, 0.1757),
    (2.75, 0.1738),
    (2.80, 0.1721),
    (2.85, 0.1703),
    (2.90, 0.1687),
    (2.95, 0.1671),
    (3.00, 0.1655),
    (3.10, 0.1625),
    (3.20, 0.1596),
    (3.30, 0.1569),
    (3.40, 0.1543),
    (3.50, 0.1519),
    (3.60, 0.1496),
    (3.70, 0.1474),
    (3.80, 0.1453),
    (3.90, 0.1433),
    (4.00, 0.1413),
    (4.20, 0.1377),
    (4.40, 0.1343),
    (4.60, 0.1312),
    (4.80, 0.1283),
    (5.00, 0.1256),
]


def get_drag_coefficient(mach: float, drag_model: list) -> float:
    """
    Interpolate drag coefficient for given Mach number
    Uses linear interpolation between table values
    """
    if mach <= drag_model[0][0]:
        return drag_model[0][1]
    if mach >= drag_model[-1][0]:
        return drag_model[-1][1]
    
    # Find bracketing values
    for i in range(len(drag_model) - 1):
        m0, cd0 = drag_model[i]
        m1, cd1 = drag_model[i + 1]
        
        if m0 <= mach <= m1:
            # Linear interpolation
            t = (mach - m0) / (m1 - m0)
            return cd0 + t * (cd1 - cd0)
    
    return drag_model[-1][1]


def form_factor_g1(bc: float, mass_grains: float, diameter_inches: float) -> float:
    """
    Calculate form factor (i) from G1 BC
    i = (mass / (BC * dÂ²)) / sectional_density_ref
    """
    mass_lbs = mass_grains / 7000.0
    sd = mass_lbs / (diameter_inches ** 2)
    return sd / bc


def form_factor_g7(bc: float, mass_grains: float, diameter_inches: float) -> float:
    """
    Calculate form factor (i) from G7 BC
    """
    mass_lbs = mass_grains / 7000.0
    sd = mass_lbs / (diameter_inches ** 2)
    return sd / bc
